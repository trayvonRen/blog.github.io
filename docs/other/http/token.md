## Token

基于 token 认证方式，不需要在服务端去保留用户的认证信息或者会话信息。这就意味着基于 token 认证机制的应用不需要去考虑用户在哪一台服务器登录了，这就为应用的扩展提供了便利。
流程上是这样的：

- 用户使用用户名密码来请求服务器
- 服务器进行验证用户的信息
- 服务器通过验证发送给用户一个 token
- 客户端存储 token，并在每次请求时附送上这个 token 值
- 服务端验证 token 值，并返回数据

JSON Web Token（缩写 JWT）是 token 认证的一种具体实现。

## JWT 的原理

JWT 的原理是，服务器认证以后，生成一个 JSON 对象，发回给用户，就像下面这样。

```json
{
  "姓名": "张三",
  "角色": "管理员",
  "到期时间": "2018年7月1日0点0分"
}
```

以后，用户与服务端通信的时候，都要发回这个 JSON 对象。服务器完全只靠这个对象认定用户身份。为了防止用户篡改数据，服务器在生成这个对象的时候，会加上签名。
服务器就不保存任何 session 数据了，也就是说，服务器变成无状态了，从而比较容易实现扩展。

## JWT 的数据结构

[阮一峰: JSON Web Token 入门教程](http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html)

## JWT 工作流程

- 浏览器首次向服务器发送请求，携带一定的用户信息（用户名，密码）
- 服务器验证用户信息，如果验证通过，使用 jwt 规范生成 token
- 浏览器以后每次请求都会携带 token

_可以把它放在 Cookie 里面自动发送，但是这样不能跨域，所以更好的做法是放在 HTTP 请求的头信息 `Authorization` 字段里面。_

```
Authorization: Bearer <token>
```

- 服务器使用签名算法验证 token 是否被篡改过。如果没有，则解析 token 实现用户认证。

## 总结

- token 和 Session + Cookie 的本质区别就服务器不保存会话状态。
- JWT 本身包含了认证信息，一旦泄露，任何人都可以获得该令牌的所有权限。为了减少盗用，JWT 的有效期应该设置得比较短。对于一些比较重要的权限，使用时应该再次对用户进行认证。
- 为了减少盗用，JWT 不应该使用 HTTP 协议明码传输，要使用 HTTPS 协议传输。
- JWT 因为认证信息保存在前端，服务器不保存用户状态，单点登录比较容易实现。

## 参考资料

[Introduction to JSON Web Tokens](https://jwt.io/introduction/)
