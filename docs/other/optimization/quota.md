## 页面/文档加载耗时

一般资源的加载会经历以下过程

![](/img/other/resource.png)

### Time to first byte (TTFB)

> TTFB 衡量从用户或客户端发出 HTTP 请求到客户端浏览器接收页面的第一个字节的持续时间。此时间由套接字连接时间，发送 HTTP 请求所花费的时间以及获取页面第一个字节所花费的时间组成。

通俗说就是 http 一次往返延迟和服务器准备响应所花费的时间。

### DOMContentLoaded (DCL)

浏览器已完全加载 HTML，并构建了 DOM 树，但像 `<img>` 和样式表之类的外部资源可能尚未加载完成。

当初始的 HTML 文档被完全加载和解析完成之后，DOMContentLoaded 事件被触发，而无需等待样式表、图像和子框架的完全加载。

### Load

浏览器不仅加载完成了 HTML，还加载完成了所有外部资源：图片，样式等

当整个页面及所有依赖资源如样式表和图片都已完成加载时，将触发 load 事件。

它与 DOMContentLoaded 不同，后者只要页面 DOM 加载完成就触发，无需等待依赖资源的加载。

## 页面渲染耗时 PaintTiming

![](/img/other/loading.png)

### First Paint（FP）

从开始加载到浏览器首次绘制像素到屏幕上的时间，也就是页面在屏幕上首次发生视觉变化的时间。但此变化可能是简单的背景色更新或不引人注意的内容，它并不表示页面内容完整性，可能会报告没有任何可见的内容被绘制的时间。

### First Contentful Paint(FCP)

FCP 测量用户导航到您的页面后浏览器呈现第一段 DOM 内容所花费的时间。页面上的图像，非白色<`canvas>`元素和 SVG 被视为 DOM 内容。

### Largest Contentful Paint（LCP）

可视区域中最大的内容元素呈现到屏幕上的时间，用以估算页面的主要内容对用户可见时间。

### First Screen Paint（FSP）

页面从开始加载到首屏内容全部绘制完成的时间，用户可以看到首屏的全部内容。
如果说 LCP 是用户看到有效内容的最近似的时间，那么在 FSP 这个时间点用户已经看到了可视区域内完整的内容，可以说是衡量用户视觉体验最合适的指标。

### Speed Index(SI)

这是一个表示页面可视区域中内容的填充速度的指标，可以通过计算页面可见区域内容显示的平均时间来衡量。

## 交互响应性相关

### First CPU Idle（FCI）

页面第一次可以响应用户输入的时间。

FCI 和 TTI 都是页面可以响应用户输入的时间。FCI 发生在用户可以开始与页面交互时；TTI 发生在 用户完全能够（可持续） 与页面交互时。

### Time to Interactive(TTI)

TTI 测量页面可以响应用户交互所花费的时间。  
在以下情况下，可以认为页面可以响应用户交互

- 该页面显示有用的内容，该内容由 First Contentful Paint 测得
- 已为大多数可见的页面元素注册了事件处理程序
- 该页面在 50 毫秒内响应用户交互。

### Frames Per Second（FPS）

帧率是视频设备产生图像（或帧）的速率，用每秒可以重新绘制的帧数（Frames Per Second，FPS）表示。

重新绘制可能需要重新计算样式、布局和绘制，如果每帧绘制到屏幕的时间在 16.7 ms 以上，每秒绘制的帧数就会小于 60 帧，人眼就能感受到页面出现卡顿，所以  FPS 是衡量应用流畅度的一个非常重要的指标，60fps 是页面流畅的目标，可以为每次绘制提供 16.7ms 的时间预算。

## 参考资料

[Lighthouse performance scoring](https://web.dev/performance-scoring/)  
[前端性能优化指南[7]--Web 性能指标](https://juejin.cn/post/6844904153869713416)
