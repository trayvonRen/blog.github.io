Koa 应用程序是一个包含一组中间件函数的对象，它是按照类似堆栈的方式组织和执行的。 Koa 类似于你可能遇到过的许多其他中间件系统，例如 Ruby 的 Rack ，Connect 等，然而，一个关键的设计点是在其低级中间件层中提供高级“语法糖”。 这提高了互操作性，稳健性，并使书写中间件更加愉快。

这包括诸如内容协商，缓存清理，代理支持和重定向等常见任务的方法。 尽管提供了相当多的有用的方法 Koa 仍保持了一个很小的体积，因为没有捆绑中间件。

## 使用中间件
```
app.use(function)
```

## 中间件的执行顺序
中间件的执行顺序符合洋葱模型  

<center><img src="/img/node/wsgi_as_onion.svg" width="350"></center>
Koa 应用程序是一个包含一组中间件函数的对象，它是按照类似堆栈的方式组织和执行的。  

- 最先入栈的中间件最先执行  
- 调用 next 函数，下一个中间件入栈并执行  
...
- 最后一个入栈的中间件执行结束，该中间件出栈，并把执行权交回上一层的中间件  
...
- 栈底的中间件执行结束，栈清空